import { Given, When, Then } from "@wdio/cucumber-framework";
import { expect, browser, $ } from '@wdio/globals';
import dotenv from 'dotenv';

// Import available page objects
let loginPage: any, dashboardPage: any, errorPage: any, generatedPage: any;
try { loginPage = require('../page-objects/generatedLoginPage').default; } catch (e) {}
try { dashboardPage = require('../page-objects/generatedDashboardPage').default; } catch (e) {}
try { errorPage = require('../page-objects/generatedErrorPage').default; } catch (e) {}
try { generatedPage = require('../page-objects/generatedPage').default; } catch (e) {}

dotenv.config();

/**
 * AUTO-GENERATED STEP DEFINITIONS
 * This file is automatically generated and deduplicated to prevent step pattern conflicts.
 * Each step pattern is unique to ensure proper Cucumber matching.
 * Supports multiple page objects: loginPage, dashboardPage, errorPage, generatedPage
 */

/**
 * Implements: "I am on the login page"
 */
Given(/^I am on the login page$/, async function () {
try {
  await browser.url(process.env.LOGIN_URL);
} catch (error) {
  const errorMessage = error instanceof Error ? error.message : String(error);
  throw new Error(`Navigation to login page failed: ${errorMessage}`);
}
});

/**
 * Implements: "I enter valid username \"admin\" and password \"password123\""
 */
When(/^I enter valid username "([^"]*)" and password "([^"]*)"$/, async function (param1, param2) {
try {
  await generatedPage.username_input.setValue('admin');
  await generatedPage.password_input.setValue('password123');
} catch (error) {
  const errorMessage = error instanceof Error ? error.message : String(error);
  throw new Error(`Form fill failed: ${errorMessage}`);
}
});

/**
 * Implements: "I click the \"submit\" button"
 */
When(/^I click the "([^"]*)" button$/, async function (param1) {
try {
  await generatedPage.submit_button.click();
} catch (error) {
  const errorMessage = error instanceof Error ? error.message : String(error);
  throw new Error(`Submit button click failed: ${errorMessage}`);
}
});

/**
 * Implements: "I should see a success message \"Login successful\""
 */
Then(/^I should see a success message "([^"]*)"$/, async function (param1) {
try {
  await expect(generatedPage.test_login_text).toBeVisible();
} catch (error) {
  const errorMessage = error instanceof Error ? error.message : String(error);
  throw new Error(`Success message failed to appear: ${errorMessage}`);
}
});

/**
 * Implements: "I enter \"invalid_username\" as my username and \"password\" as my password"
 */
When(/^I enter "([^"]*)" as my username and "([^"]*)" as my password$/, async function (param1, param2) {
try {
  await generatedPage.username_input.setValue(param1);
  await generatedPage.password_input.setValue(param2);
} catch (error) {
  const errorMessage = error instanceof Error ? error.message : String(error);
  throw new Error(`Form fill failed: ${errorMessage}`);
}
});

/**
 * Implements: "I should see \"Your username is invalid!\""
 */
Then(/^I should see "([^"]*)"$/, async function (param1) {
try {
  await expect(generatedPage.error_error).toBeVisible().withText("Your username is invalid!");
} catch (error) {
  const errorMessage = error instanceof Error ? error.message : String(error);
  throw new Error(`Error message not displayed: ${errorMessage}`);
}
});

/**
 * Implements: "the form remains on the same page"
 */
Then(/^the form remains on the same page$/, async function () {
try {
  await browser.pause(1000); 
} catch (error) {
  const errorMessage = error instanceof Error ? error.message : String(error);
  throw new Error(`Form remaining failed: ${errorMessage}`);
}
});

/**
 * Implements: "The login page is open"
 */
Given(/^The login page is open$/, async function () {
try {
  await generatedPage.open();
} catch (error) {
  const errorMessage = error instanceof Error ? error.message : String(error);
  throw new Error(`Login page failed to open: ${errorMessage}`);
}
});

/**
 * Implements: "I fill in the \"Username\" field with \"\""
 */
When(/^I fill in the "([^"]*)" field with "([^"]*)"$/, async function (param1, param2) {
try {
  await generatedPage.username_input.setValue(param1);
} catch (error) {
  const errorMessage = error instanceof Error ? error.message : String(error);
  throw new Error(`Username input failed: ${errorMessage}`);
}
});